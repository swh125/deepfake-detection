# äº‘å‡½æ•°éƒ¨ç½²è¯´æ˜

## âœ… é€‰æ‹©ç±»å‹ï¼š**Webäº‘å‡½æ•°**

ä½ çš„åº”ç”¨æ˜¯ Express HTTP æœåŠ¡ï¼Œåº”è¯¥é€‰æ‹© **Webäº‘å‡½æ•°**ï¼Œè€Œä¸æ˜¯äº‹ä»¶äº‘å‡½æ•°ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© Webäº‘å‡½æ•°ï¼Ÿ

- âœ… **ç›´æ¥å¤„ç† HTTP è¯·æ±‚**ï¼šWebäº‘å‡½æ•°ä¸“é—¨å¤„ç† HTTP/HTTPS è¯·æ±‚
- âœ… **æ”¯æŒé•¿è¿æ¥**ï¼šé€‚åˆéœ€è¦ä¿æŒè¿æ¥çŠ¶æ€çš„åº”ç”¨
- âœ… **ç¯å¢ƒå¤ç”¨**ï¼šå‡å°‘å†·å¯åŠ¨æ—¶é—´ï¼Œæé«˜æ€§èƒ½
- âœ… **è‡ªåŠ¨ HTTPS**ï¼šè‡ªåŠ¨é…ç½® SSL è¯ä¹¦

### äº‹ä»¶äº‘å‡½æ•° vs Webäº‘å‡½æ•°

| ç‰¹æ€§ | äº‹ä»¶äº‘å‡½æ•° | Webäº‘å‡½æ•° |
|------|----------|----------|
| ç”¨é€” | å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¯¹è±¡å­˜å‚¨äº‹ä»¶ | HTTP/HTTPS è¯·æ±‚ |
| è§¦å‘æ–¹å¼ | äº‹ä»¶è§¦å‘ | HTTP è¯·æ±‚è§¦å‘ |
| é€‚ç”¨åœºæ™¯ | åå°ä»»åŠ¡ã€æ•°æ®å¤„ç† | Web APIã€RESTful æœåŠ¡ |
| **ä½ çš„åº”ç”¨** | âŒ ä¸é€‚ç”¨ | âœ… **é€‚ç”¨** |

---

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend/backend-cn
npm install

# æˆ–è€…å…¨å±€åç«¯
cd backend/backend-global
npm install
```

### 2. åœ¨ CloudBase æ§åˆ¶å°åˆ›å»ºäº‘å‡½æ•°

1. ç™»å½• [è…¾è®¯äº‘ CloudBase æ§åˆ¶å°](https://console.cloud.tencent.com/tcb)
2. é€‰æ‹©æˆ–åˆ›å»ºç¯å¢ƒ
3. è¿›å…¥ã€Œäº‘å‡½æ•°ã€é¡µé¢
4. ç‚¹å‡»ã€Œæ–°å»ºäº‘å‡½æ•°ã€

### 3. é…ç½®äº‘å‡½æ•°

#### åŸºæœ¬ä¿¡æ¯
- **å‡½æ•°åç§°**ï¼š`backend-cn` æˆ– `backend-global`
- **è¿è¡Œç¯å¢ƒ**ï¼šNode.js 18.x æˆ– 20.x
- **å‡½æ•°ç±»å‹**ï¼š**é€‰æ‹©ã€ŒWebå‡½æ•°ã€** âš ï¸ é‡è¦ï¼

#### å‡½æ•°é…ç½®
- **å…¥å£æ–‡ä»¶**ï¼š`index.js`
- **å…¥å£å‡½æ•°**ï¼š`main`
- **æ‰§è¡Œè¶…æ—¶**ï¼šå»ºè®® 60 ç§’ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼‰

#### è§¦å‘å™¨é…ç½®
- **è§¦å‘æ–¹å¼**ï¼šHTTP è§¦å‘å™¨
- **è·¯å¾„**ï¼š`/*`ï¼ˆå¤„ç†æ‰€æœ‰è·¯å¾„ï¼‰
- **æ–¹æ³•**ï¼šGET, POST, PUT, DELETE, OPTIONSï¼ˆå…¨é€‰ï¼‰

### 4. ä¸Šä¼ ä»£ç 

æœ‰ä¸¤ç§æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šåœ¨çº¿ç¼–è¾‘ï¼ˆå°é¡¹ç›®ï¼‰
- ç›´æ¥åœ¨æ§åˆ¶å°ç¼–è¾‘ `index.js` å’Œ `package.json`
- ä¸Šä¼  `src/` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶

#### æ–¹å¼äºŒï¼šä¸Šä¼  ZIPï¼ˆæ¨èï¼‰
```bash
# åœ¨ backend/backend-cn ç›®å½•ä¸‹
zip -r function.zip . -x "*.git*" -x "node_modules/*" -x "*.env*"

# ç„¶ååœ¨æ§åˆ¶å°ä¸Šä¼  function.zip
```

### 5. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ CloudBase æ§åˆ¶å°çš„ã€Œç¯å¢ƒå˜é‡ã€ä¸­é…ç½®ï¼š

```env
# æ•°æ®åº“é…ç½®
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
CLOUDBASE_ENV_ID=your_cloudbase_env_id

# JWTé…ç½®
JWT_SECRET=your_jwt_secret

# æ”¯ä»˜é…ç½®
STRIPE_SECRET_KEY=your_stripe_key
PAYPAL_CLIENT_ID=your_paypal_id
PAYPAL_CLIENT_SECRET=your_paypal_secret
WECHAT_APP_ID=your_wechat_app_id
WECHAT_MCH_ID=your_wechat_mch_id
ALIPAY_APP_ID=your_alipay_app_id

# å‰ç«¯åœ°å€
FRONTEND_URL=https://your-frontend-domain.com
```

### 6. è·å–è®¿é—®åœ°å€

éƒ¨ç½²æˆåŠŸåï¼ŒCloudBase ä¼šæä¾›ï¼š
- **HTTP è§¦å‘å™¨åœ°å€**ï¼š`https://your-function-id.ap-shanghai.app.tcloudbase.com`
- **è‡ªå®šä¹‰åŸŸå**ï¼šå¯ä»¥åœ¨æ§åˆ¶å°é…ç½®è‡ªå®šä¹‰åŸŸå

---

## ğŸ”§ ä»£ç è¯´æ˜

### å…¥å£æ–‡ä»¶ï¼š`index.js`

```javascript
// ä½¿ç”¨ serverless-http åŒ…è£… Express app
const handler = serverless(app);

// Webäº‘å‡½æ•°å…¥å£
exports.main = async (event, context) => {
  // event: HTTP è¯·æ±‚äº‹ä»¶å¯¹è±¡
  // context: äº‘å‡½æ•°ä¸Šä¸‹æ–‡
  return await handler(event, context);
};
```

### å…³é”®ç‚¹

1. **å…¥å£å‡½æ•°**ï¼šå¿…é¡»æ˜¯ `exports.main`
2. **å‡½æ•°ç±»å‹**ï¼šé€‰æ‹© **Webäº‘å‡½æ•°**
3. **HTTP è§¦å‘å™¨**ï¼šé…ç½® HTTP è§¦å‘å™¨ï¼Œè·¯å¾„è®¾ä¸º `/*`
4. **ç¯å¢ƒå˜é‡**ï¼šåœ¨æ§åˆ¶å°é…ç½®ï¼Œä¸è¦ä¸Šä¼  `.env` æ–‡ä»¶

---

## ğŸ§ª æµ‹è¯•

éƒ¨ç½²åï¼Œæµ‹è¯• APIï¼š

```bash
# å¥åº·æ£€æŸ¥
curl https://your-function-url/health

# API æµ‹è¯•
curl https://your-function-url/api/v1/ip/check
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦ä¸Šä¼  `.env` æ–‡ä»¶**ï¼šç¯å¢ƒå˜é‡åœ¨æ§åˆ¶å°é…ç½®
2. **ä¸è¦ä¸Šä¼  `node_modules`**ï¼šCloudBase ä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–
3. **å…¥å£æ–‡ä»¶å¿…é¡»æ˜¯ `index.js`**ï¼šå‡½æ•°å…¥å£æ˜¯ `main`
4. **é€‰æ‹© Webäº‘å‡½æ•°**ï¼šä¸æ˜¯äº‹ä»¶äº‘å‡½æ•°
5. **é…ç½® HTTP è§¦å‘å™¨**ï¼šè·¯å¾„è®¾ä¸º `/*`ï¼Œæ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [è…¾è®¯äº‘ CloudBase Webå‡½æ•°æ–‡æ¡£](https://cloud.tencent.com/document/product/876/41134)
- [serverless-http æ–‡æ¡£](https://github.com/dougmoscrop/serverless-http)



